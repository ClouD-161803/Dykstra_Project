\ProvidesPackage{mymath}[2018/10/25 v1.0 My own math macros]


\DeclareMathOperator*{\minimise}{minimise}
\DeclareMathOperator*{\sat}{sat}
\DeclareMathOperator*{\aug}{aug}
\DeclareMathOperator*{\modu}{mod}
\DeclareMathOperator*{\trunc}{trunc}
\DeclareMathOperator*{\sgn}{sgn}
\DeclareMathOperator*{\avg}{avg}
%\DeclareMathOperator*{\argmin}{argmin}
\DeclareMathSymbol{\sm}{\mathbin}{AMSa}{"39}
\DeclareMathOperator*{\diag}{diag}
\DeclareMathOperator*{\range}{range}
\DeclareMathOperator*{\spantxt}{span}
\DeclareMathOperator*{\rank}{rank}
\DeclareMathOperator*{\inter}{int}


% some new commands
\newcommand{\set}[2]{\left\{ #1\ \left| \ #2 \right. \right\}}
\newcommand{\iprod}[2]{\left\langle #1 , #2 \right\rangle}
\newcommand{\eqdef}{\vcentcolon=}
\newcommand{\reqdef}{=\vcentcolon}
\newcommand{\I}{\text{I}}
\newcommand{\Tr}{\text{T}}
\newcommand{\x}{\mathcal{X}}
%\newcommand{\diag}{\mathrm{diag}}
%\newcommand{\rank}{\text{rank}}
\newcommand{\spanv}[1]{\spantxt\left\{ #1 \right\}}
%\newcommand{\range}{\text{range}}
\newcommand{\y}{\mathcal{Y}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\Sc}{\mathcal{S}}
\newcommand{\deriv}{\frac{\text{d}}{\text{dt}}}
\newcommand{\B}[1]{\mathbf{#1}}
\newcommand{\D}[2]{{#1}\times{#2}}
\newcommand{\inR}[3]{#1 \in \R^{\D{#2}{#3}}}
\newcommand{\inRv}[2]{#1 \in \R^{#2}}
\newcommand{\inC}[3]{#1 \in \C^{\D{#2}{#3}}}
\newcommand{\infnorm}[1]{\Vert #1 \Vert_\infty}
\newcommand{\twonorm}[1]{\Vert #1 \Vert_2}
\newcommand{\anynorm}[1]{\Vert #1 \Vert}
\newcommand{\maxnorm}[1]{\Vert #1 \Vert_{\text{max}}}
\newcommand{\frobnorm}[1]{\Vert #1 \Vert_\text{F}}
\newcommand{\abs}[1]{\left\lvert #1 \right\rvert}
\newcommand{\co}[1]{\mathcal{O}\left(#1\right)}
\newcommand{\ph}[1]{\prescript{}{\perp}{\hat{#1}}}
\newcommand{\p}[1]{\prescript{}{\perp}{#1}}
\newcommand{\trans}[1]{#1^{\text{T}}}
\newcommand{\xTx}[1]{#1^{\text{T}}#1}
\newcommand{\transbr}[1]{\left(#1\right)^{\text{T}}}
\newcommand{\herm}[1]{#1^{*}}
\newcommand{\inv}[1]{#1^{-1}}
\newcommand{\invbr}[1]{\left(#1\right)^{-1}}
\newcommand{\tinv}[1]{#1^{-\text{T}}}
\newcommand{\pinv}[1]{#1^{\dagger}}
\newcommand{\inBC}[4]{#1 \in \mathcal{BC}(#2,#3,#4)}
\newcommand{\sqrts}[1]{#1^{1/2}}
\newcommand{\BC}{\mathcal{BC}}
\newcommand{\CS}{\mathcal{CS}}
\newcommand{\SCS}{\mathcal{SCS}}
\newcommand{\rre}{\text{Re}}
\newcommand{\iim}{\text{Im}}
\newcommand{\Real}[1]{\text{Re}\left\lbrace #1 \right\rbrace}
\newcommand{\Imag}[1]{\text{Im}\left\lbrace #1 \right\rbrace}
\renewcommand{\d}[1]{\ensuremath{\operatorname{d}\!{#1}}}
% Parallel symbol
\newcommand{\pl}{{\mkern3mu\vphantom{\perp}\vrule depth 0pt\mkern3mu\vrule depth 0pt\mkern3mu}}

% Quadratic Program Stuff
\def\BigA{
\left[
\begin{array}[20]{l}
\I_N \otimes \begin{bmatrix}C & D & 0\end{bmatrix}\\
%\hline
\I_N \otimes \begin{bmatrix}A & B & -\I_{n_x}\end{bmatrix}\\
%\hline
\begin{bmatrix}\I_{n_x} & 0 & \dots & 0\end{bmatrix}
\end{array}\right]}

% Spatial Response Matrix Circulant
\def\circulantR{
\begin{bmatrix}
R_1 & R_2    & \dots & R_{n-1} & R_n\\
R_n & R_1    & R_2 & \dots & R_{n-1}\\
    & \ddots & \ddots & \ddots & \\
\end{bmatrix}}

\def\CircBB{
\begin{bmatrix}
b_0       & b_1    & \dots  & b_{n-1}\\
b_{n-1}   & b_0    & \dots  & b_{n-2}\\
\vdots    & \vdots & \ddots & \vdots \\
b_1       & b_2    & \dots  & b_{0}\\
\end{bmatrix}}

% Single Actuator Matrix
\def\singleActuator{
\begin{bmatrix}
\frac{a}{s+a} &        & 0            \\
              & \ddots &              \\
0             &        &  \frac{a}{s+a}\\
\end{bmatrix}}

% Multi Actuator Matrix
\def\multiActuator{
\begin{bmatrix}
\frac{a_s}{s+a_s}\I_{m_s} & & 0 \\
                    & & \\
0                   & & \frac{a_f}{s+a_f}\I_{m_f}\\
\end{bmatrix}}
\def\multiA{
\begin{bmatrix}
-a_s\I_{m_s} & & 0 \\
                    & & \\
0                   & & -a_f\I_{m_f}\\
\end{bmatrix}}
\def\multiAdt{
\begin{bmatrix}
\scriptstyle{e^{-a_sT_s}}\I_{m_s} &  0 \\
0                   &  \scriptstyle{e^{-a_fT_s}}\I_{m_f}\\
\end{bmatrix}}
\def\multiB{
\begin{bmatrix}
a_s\I_{m_s} & & 0 \\
                    & & \\
0                   & & a_f\I_{m_f}\\
\end{bmatrix}}
\def\multiBdt{
\begin{bmatrix}
\scriptstyle{(1-e^{-a_sT_s})}\I_{m_s} & 0 \\
0                       & \scriptstyle{(1-e^{-a_fT_s})} \I_{m_f}\\
\end{bmatrix}}
\def\multiAs{
\begin{bmatrix}
-a_s\I_{m_s} &  0 \\
0            & -a_f\I_{m_f}\\
\end{bmatrix}}
\def\multiBs{
\begin{bmatrix}
a_s\I_{m_s} & 0 \\
0           & a_f\I_{m_f}\\
\end{bmatrix}}
\def\multiX{\begin{pmatrix} \B{x}_s \\ \B{x}_f \end{pmatrix}}
\def\multiXt{\begin{pmatrix} \B{x}_s(t) \\ \B{x}_f(t) \end{pmatrix}}
\def\multiXtT{\begin{pmatrix} \B{x}_s(t)^\text{T} & \B{x}_f(t)^\text{T} \end{pmatrix}^\text{T}}
\def\multiXdtp1{\begin{pmatrix} \B{x}_s^{k+1} \\ \B{x}_f^{k+1}  \end{pmatrix}}
\def\multiXdt{\begin{pmatrix} \B{x}_s^k \\ \B{x}_f^k \end{pmatrix}}
\def\multiXdtd{\begin{pmatrix} \B{x}_s^{k-k_\tau} \\ \B{x}_f^{k-k_\tau} \end{pmatrix}}
\def\multiXtd{\begin{pmatrix} \B{x}_s(t-\tau_d) \\ \B{x}_f(t-\tau_d) \end{pmatrix}}
\def\multiXdot{\begin{pmatrix} \dot{\B{x}}_s \\ \dot{\B{x}}_f \end{pmatrix}}
\def\multiU{\begin{pmatrix} \B{u}_s \\ \B{u}_f \end{pmatrix}}
\def\multiUt{\begin{pmatrix} \B{u}_s(t) \\ \B{u}_f(t) \end{pmatrix}}
\def\multiUdt{\begin{pmatrix} \B{u}_s^k \\ \B{u}_f^k \end{pmatrix}}

% LQRI MATRICES
\def\Aintaug{
\begin{bmatrix}
\I_{n_y} &  \B{C}_\text{aug} \\
0 &  \B{A}_\text{aug} \\
\end{bmatrix}}
\def\Bintaug{
\begin{bmatrix}
0 \\
\B{B}_\text{aug} \\
\end{bmatrix}}
\def\Qintaug{
\begin{bmatrix}
q_v\I &  0 \\
0 &  \B{C}_\text{aug}^\text{T}\B{C}_\text{aug} \\
\end{bmatrix}}
\def\Xintaugp1{\begin{pmatrix} \B{v}_{k+1} \\ \B{\tilde{x}}_{k+1}  \end{pmatrix}}
\def\Xintaug{\begin{pmatrix} \B{v}_{k} \\ \B{\tilde{x}}_{k}  \end{pmatrix}}
\def\XintaugT{\begin{pmatrix} \B{v}_k^\text{T} & \B{\tilde{x}}_k^\text{T} \end{pmatrix}}

% Disturbance Matrices
\def\Adistaug{
\begin{bmatrix}
\B{A} &  0 \\
0 &  \B{A}_\text{d} \\
\end{bmatrix}}
\def\Bdistaug{
\begin{bmatrix}
\B{B}\\
0\\
\end{bmatrix}}
\def\Bdist{
\begin{bmatrix}
0\\
\I_{n_y}\\
\end{bmatrix}}
\def\Xdistaugp1{\begin{pmatrix} \B{x}_{k+1} \\ \B{x}^\text{d}_{k+1}  \end{pmatrix}}
\def\Xdistaug{\begin{pmatrix} \B{x}_{k} \\ \B{x}^\text{d}_{k}  \end{pmatrix}}
\def\Xdistaugp1h{\begin{pmatrix} \hat{\B{x}}_{k+1} \\ \hat{\B{x}}^\text{d}_{k+1}  \end{pmatrix}}
\def\Xdistaugh{\begin{pmatrix} \hat{\B{x}}_{k} \\ \hat{\B{x}}^\text{d}_{k}  \end{pmatrix}}

% MPC Stuff
\newcommand{\ubar}[1]{\text{\b{$#1$}}}
\DeclareMathOperator*{\argmin}{arg\,min}
\def\XkUk{\begin{pmatrix} \B{x}_{k} \\ \B{u}_{k}  \end{pmatrix}}
\def\XkUkthin{\begin{bmatrix} x_{k} \\ u_{k}  \end{bmatrix}}
\def\XkUkhat{\begin{pmatrix} \hat{\B{x}}_{k}^i \\ \hat{\B{u}}_{k}^i  \end{pmatrix}}
\def\QR{\begin{bmatrix}\B{Q} &  \\ &  \B{R} \\ \end{bmatrix}}
\def\QRthin{\begin{bmatrix}Q & 0 \\0 &  R \\ \end{bmatrix}}
\def\QRhat{
\begin{bmatrix}
\hat{\B{Q}}^i &  \\
 &  \hat{\B{R}}^i \\
\end{bmatrix}}
\def\QRPA{
\begin{bmatrix}
\B{C}^\text{T}\B{C} &  \\
 &  \B{R} \\
\end{bmatrix}}
\def\ABCD{
\begin{bmatrix}
\B{A} & \B{B} \\
\B{C} & \B{D} \\
\end{bmatrix}}
\def\TxTy{
\begin{bmatrix}
\B{\Theta}_x &  \\
 & \B{\Theta}_y \\
\end{bmatrix}}
\def\TxTu{
\begin{bmatrix}
\B{\Theta}_x &  \\
 & \B{\Theta}_u \\
\end{bmatrix}}
\def\PhixPhiu{
\begin{bmatrix}
\B{\Phi}_x &  \\
 & \B{\Phi}_u \\
\end{bmatrix}}
\def\PhixPhiy{
\begin{bmatrix}
\B{\Phi}_x &  \\
 & \B{\Phi}_y \\
\end{bmatrix}}

% Block diag matrices
\def\Abdiag{
\begin{array}{ccc}
\hat{\B{A}}_1 &        &\\
        & \ddots &\\
        &        & \hat{\B{A}}_m\\
\end{array}}
\def\Bbdiag{
\begin{array}{ccc}
\hat{\B{B}}_1 &        &\\
        & \ddots &\\
        &        & \hat{\B{B}}_m\\
\end{array}}
\def\Cbdiag{
\begin{array}{ccc}
\hat{\B{C}}_1 &        &\\
        & \ddots &\\
        &        & \hat{\B{C}}_m\\
\end{array}}
\def\Dbdiag{
\begin{array}{ccc}
\hat{\B{D}}_1 &        &\\
        & \ddots &\\
        &        & \hat{\B{D}}_m\\
\end{array}}
\def\ABCDdiag{
\left[
\begin{array}{c|c}
\Abdiag & \Bbdiag \\
\hline
\Cbdiag & \Dbdiag
\end{array}
\right]}

% Danielson Stuff
\def\PhiSym{
\begin{bmatrix}
1  &    &        & \dots  & 1\\
-1 & 1  &        &        &\\
   & -2 & 1      &        & \vdots \\
   &    & \ddots & \ddots &\\
   &    &        & -m+1   & 1\\
\end{bmatrix}}

% Circulant Matrices
\def\Cn{\mathcal{C}(n)}
\def\CnR{\mathcal{C}^\R(n)}
\def\CnC{\mathcal{C}^\C(n)}
\def\BCnpmR{\mathcal{BC}^\R(n,p,m)}
\def\BCnpmC{\mathcal{BC}(n,p,m)}

\def\BCn{\mathcal{BC}(n,m)}
\def\BCpn{\mathcal{BC}(pn,m)}
\def\CircC{
\begin{bmatrix}
c_0       & c_1 & c_2 & \dots & c_{n-1}\\
c_{n-1}   & c_0 & c_1 & \dots & c_{n-2}\\
\vdots    &     &     &       & \vdots \\
c_1       & c_2 & c_3 & \dots & c_{0}\\
\end{bmatrix}}
\def\CircB{
\begin{bmatrix}
b_0       & b_1 & b_2 & \dots & b_{n-1}\\
b_{n-1}   & b_0 & b_1 & \dots & b_{n-2}\\
\vdots    &     &     &       & \vdots \\
b_1       & b_2 & b_3 & \dots & b_{0}\\
\end{bmatrix}}
\def\CircTone{\begin{tiny}
\begin{bmatrix}
0       & 1      & 0      & \dots  & 0\\
\vdots  & 0      & 1      &        & \vdots\\
        & \vdots & \ddots & \ddots & 0\\
0       &        &        &        & 1\\
1       & 0      & \dots  &        & 0\\
\end{bmatrix}\end{tiny}}
\def\CircTtwo{\begin{tiny}
\begin{bmatrix}
0       &0       & 1      & 0      & \dots  & 0\\
\vdots  & \vdots & 0      & 1      &        & \vdots\\
0       &        & \vdots & \ddots & \ddots & 1\\
1       &0       &        &        &        & 0\\
0       &1       & 0      & \dots  &        & 0\\
\end{bmatrix}\end{tiny}}
\def\CircPhi{
\begin{bmatrix}
w_0 & w_1 & \dots & w_{n-1}
\end{bmatrix}}
\def\CircWj{
\begin{pmatrix}
1 & \rho_j & \rho_j^2 & \dots & \rho_j^{n-1}
\end{pmatrix}}

% Circulant PA
\def\APA{
\begin{array}{ccccc}
a_s &     &        &     &\\
    & a_f &        &     & \\
    &     & \ddots &     & \\
    &     &        & a_s & \\
    &     &        &     & a_f\\
\end{array}}
\def\BPA{
\begin{array}{ccccc}
b_s &     &        &     &\\
    & b_f &        &     & \\
    &     & \ddots &     & \\
    &     &        & b_s & \\
    &     &        &     & b_f\\
\end{array}}
\def\CPA{
\begin{array}{cccc}
c_0 & c_1 & c_2 & c_3\\
c_3 & c_0 & c_1 & c_2\\
c_2 & c_3 & c_0 & c_1\\
c_1 & c_2 & c_3 & c_0\\
\end{array}}
\def\ABCDPApart{
\left[
\begin{array}{c|c}
\B{A} & \B{B} \\
\hline
\B{C} & \B{D}
\end{array}
\right]}
\def\ABCDPA{
\left[
\begin{array}{c|c}
\APA & \BPA \\
\hline
\CPA & 0
\end{array}
\right]}
\def\im{\text{i}}
\def\PhiPA{
\left[
\begin{array}{rrrr}
1 & 1    & 1  & 1\\
1 & \im  & -1 & -\im\\
1 & -1   & 1  & -1\\
1 & -\im & -1 & \im\\
\end{array}\right]}


% Thin ABCD block circulant decomposition
\def\Ahatdiag{
\begin{array}[0.05]{ccc}
\hat{a}_1 &        &\\
        & \ddots &\\
        &        & \hat{a}_n\\
\end{array}}
\def\Bhatdiag{
\begin{array}[0.05]{ccc}
\hat{b}_1 &        &\\
        & \ddots &\\
        &        & \hat{b}_n\\
\end{array}}
\def\Chatdiag{
\begin{array}[0.05]{ccc}
\hat{c}_1 &        &\\
        & \ddots &\\
        &        & \hat{c}_n\\
\end{array}}
\def\Dhatdiag{
\begin{array}[0.05]{ccc}
\hat{d}_1 &        &\\
        & \ddots &\\
        &        & \hat{d}_n\\
\end{array}}
\def\ABCDdiag{
\left[
\begin{array}[0.05]{c|c}
\Ahatdiag & \Bhatdiag \\
\hline
\Chatdiag & \Dhatdiag
\end{array}
\right]}
\def\ABCDthin{
\begin{bmatrix}
A & B\\ C & D
\end{bmatrix}}
\def\ABCDthindiag{
\begin{bmatrix}
\Ahatdiag & \Ahatdiag\\ \Ahatdiag & \Ahatdiag
\end{bmatrix}}
\def\Psithin{
\begin{bmatrix}
\Psi & 0 \\ 0  & \Psi
\end{bmatrix}}


\def\psixy{
\begin{bmatrix}
\psi_x &  0\\ 0  & \psi_y
\end{bmatrix}}
\def\psixu{
\begin{bmatrix}
\psi_x & 0 \\  0 & \psi_u
\end{bmatrix}}

% Equivalence proof stuff
\def\x_equiv{
\begin{bmatrix}
x_0\\x_1\\x_2\\\vdots\\x_N
\end{bmatrix}}
\def\u_equiv{
\begin{bmatrix}
u_0\\u_1\\\vdots\\u_{N-1}
\end{bmatrix}}
\def\G_equiv{
\begin{bmatrix}
0		& 0			& \dots		& 0\\
B		& 0			&			& \\
AB		& B			&			&\\
\vdots	& \vdots	& \ddots	&\vdots\\
A^{N-1}B& A^{N-2}B	& \dots		& B
\end{bmatrix}}
\def\H_equiv{
\begin{bmatrix}
I\\A\\A^2\\\vdots\\A^N
\end{bmatrix}}

\def\Aone{
\begin{bmatrix}
I_{N-1}\otimes(Q+\rho C^\Tr C) & 0\\
0 & P
\end{bmatrix}}
\def\Athree{
\begin{bmatrix}
I_{N-1}\otimes 2\rho C^\Tr D\\
0
\end{bmatrix}}
\def\Afour{
\begin{bmatrix}
I_{N-1}\otimes -2\rho C^\Tr\\
0
\end{bmatrix}}


% Slow and fast R
\def\multiR{
\begin{bmatrix}
\B{R}_s & \B{R}_f
\end{bmatrix}}
\def\multiRa{
\begin{bmatrix}
a_s\B{R}_s & a_f\B{R}_f
\end{bmatrix}}

% Dynamic System
\def\dynSys{
\begin{matrix}
\dot{\B{x}} = \B{A}\,\B{x}\,+\,\B{B}\,\B{u}\\
\B{y} = \B{C}\,\B{x}
\end{matrix}}

% Scaling Matrices
\def\Dyscaling{
\begin{bmatrix}
\Delta y_{max} &        & 0            \\
              & \ddots &              \\
0             &        &  \Delta y_{max}\\
\end{bmatrix}}
\def\Duscaling{
\begin{bmatrix}
u_{max}       &        & 0            \\
              & \ddots &              \\
0             &        &  u_{max}\\
\end{bmatrix}}
\def\Ddscaling{
\begin{bmatrix}
d_{max,1}       &        & 0            \\
              & \ddots &              \\
0             &        &  d_{max,n}\\
\end{bmatrix}}

% Delay augmentation
\def\Xaugmented{
\begin{pmatrix}
\B{z}_\text{-1} \\ \B{z}_\text{-2} \\ \vdots \\ \vdots \\ \B{z}_\text{-D} \\ \B{x}^{\phantom{D}}\end{pmatrix}}
\def\Baugmented{
\begin{bmatrix}
\I \\ 0 \\ \vdots \\ \\ \vdots \\ 0 \end{bmatrix}}
\def\Aaugmented{
\begin{bmatrix}
0      & \dots  & \dots  & \dots  & \dots  & 0\\
\I     & 0      & \ddots & \ddots & \ddots & \vdots\\
0      & \I     & \ddots & \ddots & \ddots & \vdots\\
\vdots & 0      & \ddots & \ddots & \ddots & \vdots\\
\vdots & \ddots & \ddots & \I     & 0      & 0\\
0      & \dots  & \dots  & 0      & \B{B}  & \B{A}\\
\end{bmatrix}}

\def\XaugmentedOut{
\begin{pmatrix}
\B{x}^{\phantom{1}} \\ \B{x}_\text{-1} \\ \B{x}_\text{-2} \\ \vdots \\ \vdots \\ \B{x}_\text{-D}
\end{pmatrix}}
\def\XaugmentedOutT{
\begin{pmatrix}
\B{x}^{\text{T}} & \B{x}_\text{-1}^{\text{T}} & \B{x}_\text{-2}^{\text{T}} & \dots & \dots & \B{x}_\text{-D}^{\text{T}}
\end{pmatrix}}
\def\BaugmentedOut{
\begin{bmatrix}
\B{B} \\ 0 \\ \vdots \\ \\ \vdots \\ 0 \end{bmatrix}}
\def\AaugmentedOut{
\begin{bmatrix}
\B{A}  & 0      & \dots  & \dots  & \dots  & 0\\
\I     & 0      & \ddots & \ddots & \ddots & \vdots\\
0      & \I     & \ddots & \ddots & \ddots & \vdots\\
\vdots & 0      & \ddots & \ddots & \ddots & \vdots\\
\vdots & \ddots & \ddots & \ddots & \ddots & \vdots\\
0      & \dots  & \dots  & \dots  & \I     & 0\\
\end{bmatrix}}
\def\CaugmentedOut{
\begin{bmatrix}
0 & \dots & \dots & & 0 & \B{C} \end{bmatrix}}
